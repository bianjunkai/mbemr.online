---
title: 捣鼓家里的网络世界 II
author: bjkdtc
date: 2020-01-29T14:08:05+00:00

categories:
  - 野记
  - 野路子
tags:
  - 技术
  - 日常捣鼓

---
2018年到2019年以来，一直在捣鼓着家里的网络，今年春节前算是完成了主体工程，回头来记录一下这段过程。至于为什么这篇是第二篇，因为第一篇给自己画了一个大饼，最后看来是实现不了了，还不如重新写！

## 网络背景描述

我家的总体网络覆盖需要有3个房间，2个厅。总体可以分为两个区域，网络热区（常用区，基本需要时刻覆盖）和网络冷区（一般不常用）。网络热区是客厅、主卧和书房，次卧、餐厅等其他环境由于平时没有太多人，所以网络简单覆盖即可。在前期装修的时候，弱电箱在大门边，家中共计8个网线口，均是超五类网线的预埋，都汇总到了弱电箱中（这里给自己挖了个大坑，以后再记）。  
从网络需求来说，硬需求有书房有一台台式机需要使用网线直连，客厅中电视机需要联网，电信IPTV需要专口专用（再不做大的修改的情况下），家用NAS需要一台作为日常照片、文件的存放用，其他则是一些家用物联网设备的接入。软需求则是家中各台手机、手提电脑的网络接入。

## 最初的网络，Huawei WS5100见证的天真

搬入新家以后，在无线路由器的选择上进行了一番挣扎。主要考虑的价格和信号的问题。当时有几种选择，1是采用无线中继的方式，在餐厅增加一个子路由来完成网络扩展；2是买一台相对强劲的无线路由器，一台解决问题。在当时没有太多需求的情况下，考虑到想用华为系来组建简单的智慧家庭网络这个点，就采购了一台Huawei WS5100的路由器，将它放在了书柜下方作为全家唯一的网络输出。这个选择天真惨淡的结局在路由器到位的第一周就尽显无疑：信号覆盖能力太弱。即使在一墙之隔的主卧，网速都弱的流泪，根不要提书房及次卫这些角落。应急之下，又拿了一台父母家组网多出来的荣耀1S，想利用两台路由器完成无线网络的覆盖，但效果只能说是杯水车薪，在不将路由器放入主卧的情况下，主卧的网络基本没法用。  
总结这个天真的过程，主要有几个经验：  
1. 穿墙能力是普通家用路由的唯一价值：除非采用电力猫这样的手段，如果只是想利用WIFI中继来联网，那核心路由器的穿墙能力决定了网络的质量。既然使用了WIFI中继,那无线路由器之间的连接还是依赖着无线信号。主路由穿不过的墙，墙后的子路由也只能当个摆设。  
2. 手机上无线信号的强度和手机的无线速度没任何关系：手机上的无线信号强度只能表明手机收到的无线信号强弱，但网速的衰减跟这个信号没有任何关联，它取决于进入发出信号的路由的网速、路由到手机之间的衰减、信道的干扰等等  
3. 路由器该花的钱要花，带来的体验截然不同：当时天真的以为华为也算是大厂了，卖的路由应该比TP-LINK什么的好吧。但事实上，专业的人做专业的事，路由器还是该买华硕、磊科之类的，小米、华为这些所谓的智能路由器多了点无聊的噱头，皇帝的新衣罢了。

## 第一台NAS，入坑群晖DS218play

搬了新家，第一个想要玩的花头是NAS。其实的NAS的选择其实是很显而易见，1. 成品群晖（不是我看不上威联通，淘宝搜索“NAS”首页寥寥数个结果已经说明在绝大部分买家中群晖的地位）2. 黑群晖 3.自购成品或DIY机器搭载windows或linux服务器。对于普通家庭用户来说，成品群晖入手即可。从我自己的角度来说，想买NAS的初衷主要有3点：  
1. 家里各台手机拍的照片、视频需要有一个地方备份，同时能在家庭成员间做一些共享。不想用百度云是因为当照片和视频数量比较多以后，百度云的限速下载能让你痛恨自己当初选择百度云做备份。（亲身经历：婚礼完整视频4个G，放在百度云上，想下载到本地备份的时候，感觉像是这婚礼视频拍的是别人）  
2. 在NAS上下载一些电影（盗版），能够在家里享受一下电影院的感觉。  
3. 一点点装逼的feel。  
作为一个小成本玩家，我非常在意时间成本和金钱成本。 黑群晖固然在机器的购入上面能够省下一笔钱（前提是你需要相当的性能），但是同样你需要在搭建黑群晖，处理黑群晖的各类阉割，不靠谱机器的折腾等方面投入更大的成本，这些对于普通家庭用户来说，是得不偿失的。而windows/Linux服务器则更加，例如：想购买Dell Gen10服务器，淘宝的最低价在3500元（裸机），而购入后还需要自己去安装系统，搭建各类服务，对于普通用户来说也是相当巨大的投入。综合以上的考虑，我最后选择了直接买成品群晖，然而……选错了机器。我买的设备是DS218play+2块2T的希捷酷鱼硬盘，原因？预算太低。 机器的价格当时是天猫1799入手，外加两块2T硬盘727，基本上在2500块全部搞定。但是，我忽略了扩展性的问题！随着NAS的购入，越来越多的可描述的不可描述的片子都挤进了我的硬盘，2T的容量转眼就没了空间，而双盘位的机器意味着，老盘只能给新盘让位……现在我只能重新准备机会买DS418play和4T的硬盘了。  
总结NAS的经验：  
1. 不要低估扩展性和硬盘的重要性，如果金钱允许4盘位的DS418play作为入门是正确的选择。如果金钱不允许，DS218play是经济型的选择，再不考虑电影的情况下，自己拍摄的照片和视频其实目前也就是300G左右，所以双盘位+2T+2T 应该是能够满足日常所需的  
2. NAS的影视服务用EMBY+KODI大法，能够完美适应家中所需  
3. 如果买NAS更多是为了动手，请千万不要买白群晖，特别是低端系列。最好还是黑群晖或者Windows/Linux的服务器。

## 梅林固件和软路由

基于之前的无线路由器的教训，我之后换了华硕AC66U B1（等于AC68U）约550RMB。买华硕自然是为了梅林固件去的，一开始看了很多关于Koolshare的负面消息，所以只是刷了官改梅林，没有软件中心的梅林固件就是没有灵魂的梅林。于是还是刷了Koolshare的版本，Koolshare上对于armv7版本及更早的路由现在的支持也越来越少了，估计也是人手的问题。在软件中心中我主要用了两个插件，一个是不可描述，另一个则是frp内网穿透服务。由于之前致电10000号想要一个公网IP，遭遇客服妹妹的柔情拒绝后拉不下脸来继续要，外加群晖和华硕自带的ddns都相对受限，于是只能自己做了个frp内网穿透。但是有梅林路由的最大苦恼是由于插件的原因，路由器经常CPU100%，导致网络故障，每次都要手动重启。一狠心还是入了软路由，把AC66UB1变成了无线AP。软路由其实现在也没什么太大的难度了，淘宝直接搜，下单还附送装好Lede操作系统。当然由于Lede年久失修，我之后还是改了L大的openwrt，用的是e大编译的固件。  
总结梅林固件和软路由的经验：  
1. 梅林还是要用Koolshare的，其实开源还是封闭都是自己心里的感觉，有了软件中心就可以体验各种不一样的能力，这次是玩梅林的意义。但是无线路由的CPU和内存终究是有限的，用了太多插件路由器容易卡死。  
2. 软路由家庭用J1900就足够了，其实也没有太多的需求，主要是不可描述的功能以及能够多一些DNS的选择罢了。我也没有去改光猫的桥接，毕竟直到现在我的上网需求还没有明显的差异。