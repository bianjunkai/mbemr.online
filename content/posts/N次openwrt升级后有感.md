---
title: "N次openwrt升级后有感"
date: 2021-01-03T11:36:01+08:00
author: bjkdtc
tags:
    - 日常捣鼓
categories:
    - 野路子
---

# 资源准备

设备：淘宝 J1900 工控机

Openwrt 编译来源：Esir Google Drive - 精品小包 2021 元旦版本 

默认地址 192.168.5.1 root 无密码

# 安装系统

## 完全重装机器

1. 连接显示器（VGA/HDMI）和键鼠套装 
2. 制作U盘启动工具，并将openwrt固件解压到安装盘中
3. 开机，利用U盘安装工具按照系统

## 机器已有系统

### openwrt版本升级

1. 通过另外一台设备进入192.168.5.1的管理工具界面
2. 进入“系统” - “备份/升级”-导入已解压的固件

**不保留配置适用于openwrt的内核或使用的软件有较大变化的情况，一旦重装极有可能会由于物理端口的变化而导致无法开机** 

### 能通过另一台电脑连通192.168.5.1

1. 设备开机并利用网线与另一台电脑相连
2. 利用其他设备的putty或ssh终端进入192.168.5.1
3. 将Openwert解压后固件放置在 /tmp/upload中并命名为op.img
4. 输入命令 `dd if=/tmp/upload/op.img of=/dev/sda`

###  无法通过另一台电脑连通192.168.5.1

1. **检查网络端口插线 - 将测试机器连入第一段口，光猫连入第二端口**
2. 如果仍然无法连通192.168.5.1，则继续
3. 将工控机连接显示器（VGA/HDMI）和键鼠套装 
4. 利用U盘将Openwert解压后固件放置在 /tmp/upload中并命名为op.img
5. 输入命令 `dd if=/tmp/upload/op.img of=/dev/sda`

**一般无法连通192.168.5.1 极有有可能是网线连接的工控机端口不对，默认只采用了eth0和eth1，网线应该连接第一个端口（可能工控机标注的端口名不是eth0）**

## 安装完成检查

1. 通过另外一台电脑能够连通192.168.5.1(浏览器或终端工具)
2. 采用显示器+键鼠套装，进入后查看系统是否正常运行，能否通过ifconfig查看地址（适用于由于升级，导致端口发生重置，而无法上网的情况）

# 系统基础配置

## 网络配置

1. 进入“网络” - “接口”
2. 删除IPv6的相关配置，注意在“lan”口中也要关闭IPv6
3. 进入“WAN”- 选择“物理设置”-选择“eth3”
4. 进入“LAN” - 选择“物理设置”-选择“eth0-eth1-eth2”

# 服务配置

## ShadowSocksR Plus+ 设置

1. 选择“服务器节点” - “SS/SSR/V2/TROJAN订阅URL” 
2. 点击“更新订阅URL列表”
3. 点击“更新订阅URL列表”
4. 选择下方节点中延迟最小的节点
5. 注意检查“运行模式”为“绕过中国大陆IP模式”

## 解锁网易云音乐灰色歌曲

1. 点击开启

    **效果不一定稳定，PC端效果比较好，同时需要修改代理地址到192.168.5.1**

## 京东签到服务

1. 下载chrome插件，下载JDCookie.zip
2. chrome浏览器选择[chrome://extensions/]中使用加载已解压的扩展程序进行安装
3. 点击京东链接，并登录，再点击右上角京东金豆标记
4. 粘贴cookie到主账号Cookie
5. 选择更新时间和签到时间
6. 执行“保存cookie并签到”

## Frp内网穿透

1. 填入服务器地址（一般为转发的VPS服务器地址）
2. 填入端口+令牌
3. 添加单个服务，输入“自定义域名”、“内网主机地址”、“内网主机端口”、“服务备注名”
4. 注意关闭“高级设置”中“TCP”端口复用（除非服务器端做相同配置）
5. 注意服务器时间和路由器时间一致，路由器时间看frp-日志中的时间（不是路由器显示时间），对应调整服务器时间到同一时区，否则会服务无法注册



